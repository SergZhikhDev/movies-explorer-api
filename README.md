# movies-explorer-api
# Резюме:
## Backend

### Критерии, влияющие на работоспособность
- [x] <!--3.64--> В репозитории есть все необходимые инфраструктурные файлы:
  - [x] в проекте есть package.json;
  - [x] .editorconfig;
  - [x] .eslintrc, расширяющий конфигурацию airbnb-base, а также необходимые для работы линтера dev-зависимости;
  - [x] .gitignore.
  - [x] в .eslintrc добавлено исключение для _id. Директивы eslint-disable, eslint-disable-line и eslint-disable-next-line запрещены.
- [x] <!--3.64--> Нет ошибок линтера. При выполнении команды npx eslint . они должны отсутствовать.
- [x] <!--3.64--> В разделе scripts файла package.json есть команды:
  - [x] npm run start, которая запускает сервер на localhost:3000;
  - [x] npm run dev, которая запускает сервер на localhost:3000 с хот релоудом.
- [ ] <!--21.81--> Описанные роуты работают корректно:
  - [x] запрос на `GET /users/me` возвращает информацию о пользователе (email и имя);
  - [ ] `PATCH /users/me` — обновляет информацию о пользователе;
  **Информация о пользователе не обновляется**
![2022-08-09_11-56-40](https://user-images.githubusercontent.com/86304001/183567700-d558af84-d505-4fe2-b3eb-d4a17c7ce137.png)
  - [x] `GET /movies` — все сохранённые пользователем фильмы;
  - [x] `POST /movies` — создаёт фильм с переданными в теле данными;
  - [x] `DELETE /movies/movieId` — удаляет сохранённый фильмы по `_id`;
  - [x] `POST /signup` — создаёт пользователя с переданными в теле данными;
  - [x] `POST /signin` — возвращает JWT, если в теле запроса переданы правильные почта и пароль.
  - [ ] Если вы сохраняете JWT в куках, роут `/signout` должен удалять JWT из куки.
- [x] <!--3.64--> Пользователь не может удалить сохранённый фильм из профиля другого пользователя.
- [ ] <!--3.64--> Все роуты, кроме /signin и /signup, защищены авторизацией.
**Не защищен роут "Страница не найдена"**
- [x] <!--3.64--> Роуты пользователей и роуты фильмов описаны в отдельных файлах.
- [ ] <!--7.28--> Ошибки API обрабатываются:
  - [x] используются статус-коды ошибок: 400, 401, 403, 404, 409, 500;
  - [ ] если в запросе что-то не так, сервер возвращает статус ответа, который соответствует типу ошибки;
	- [ ] сообщение об ошибке соответсвует ее типу;
	**1. Неверное сообщение при попытке удалить чужую карточку**        
![2022-08-09_11-59-20](https://user-images.githubusercontent.com/86304001/183568032-2150b041-4016-4ff7-8489-2700431a37c2.png)
        **2. Не обработана ошибка дубля `email` при редактировани пользователя**
  - [x] асинхронные обработчики завершены блоком catch;
  - [x] API не возвращает стандартных ошибок базы данных или Node.js.
- [x] <!--3.64--> Реализовано бережное хранение пароля:
  - [x] пароль хранится в виде хеша;
  - [x] API не возвращает хеш пароля клиенту.
- [ ] <!--7.28--> Валидация реализована верно:
  - [ ] Запрос валидируется перед передачей контроллеру. Тело и, где необходимо, заголовки и параметры проверяются по соответствующим схемам. Если запрос не соответствует схеме, обработка не передаётся контроллеру, и клиент получает ошибку валидации.
  **1. `movieId` при удалении карточки должен быть обязательным**
  **2. Лишнее поле `password` при редактировании профиля**
  **3. Поля `duration` и `movieId` должы валидироваться как числа**
  - [ ] Данные валидируются перед добавлением в базу.
  **Лишнее поле `createdAt` на уровне схемы фильма**
- [ ] <!--7.28--> В production-режиме адрес базы данных берётся из process.env.
**Адрес базы один и тот же в любом режиме**
- [ ] <!--3.64--> К серверу можно обратиться по https по адресу домена, указанному в README.md.
**К серверу нельзя обратиться**
![2022-08-09_12-18-27](https://user-images.githubusercontent.com/86304001/183570331-fffcc2d9-144d-4f92-a49c-f90cd076759c.png)
- [ ] <!--7.28--> Правильно реализовано хранение секретного ключа для создания JWT:
  - [ ] для продакшн сборки он хранится в .env файле — этот файл не добавляется в git;
  **1. Неверное условие выбора ключа. Условие всегда ложное. Вы ставниваете объект со строкой .Условие всегда ложное. В продакшен-режиме ключ не будет браться из окружения.**
![2022-08-09_12-06-33](https://user-images.githubusercontent.com/86304001/183568911-c4b983ce-1408-44ec-8cb7-96bfcd6181a2.png)  
![2022-08-09_12-28-41](https://user-images.githubusercontent.com/86304001/183571524-d32a7a6e-6163-4db6-839d-b5c997df1331.png)
  **2. В `auth` не предусмотрен выбор ключа в зависимости от режима запуска**  
![2022-08-09_12-27-34](https://user-images.githubusercontent.com/86304001/183571427-e2433162-062a-4c07-a54a-2c550661e171.png)
  - [x] в режиме разработки (при process.env.NODE_ENV !== 'production') код запускается и работает и без .env файла.

### Хорошие практики
- [x] <!--2.14--> Все роуты подключены в файле index.js, который находится в папке routes. Оттуда единый роут подключается в файле app.js.
- [x] <!--2.14--> Асинхронные операции реализованы промисами или async/await.
- [x] <!--2.14--> Валидация описана в отдельном модуле.
- [ ] <!--2.14--> Настроено логгирование:
  - [ ] запросы и ответы записываются в файл request.log;
  **Логгер запросов подключен после лимитера. Запросы, превышающие лимит, не попадают в лог**
  - [x] ошибки записываются в файл error.log;
  - [x] файлы логов не добавляются в репозиторий.
- [x] <!--2.14--> Ошибки обрабатываются централизованным обработчиком.
- [x] <!--2.14--> Централизованный обработчик ошибок описан в отдельном модуле.
- [x] <!--2.14--> API приложения располагается на домене вида: name.zone/api, а не просто name.zone

### Рекомендации
- [x] <!--0.71--> Для ошибок API созданы классы, расширяющие конструктор Error.
- [x] <!--0.71--> Используется модуль Helmet для установки заголовков, связанных с безопасностью.
- [ ] <!--0.71--> Конфигурация и константы в отдельных файлах:
  - [x] адрес Mongo-сервера в режиме разработки вынесен в отдельный конфигурационный файл;
  - [ ] сообщения ответов и ошибок (константы приложения) вынесены в отдельный файл с константами.
  **Сообщение прописаны вручную**
- [x] <!--0.71--> Настроен rate limiter: число запросов с одного IP в единицу времени ограничено.
- [x] <!--0.71--> Rate limiter сконфигурирован в отдельном файле и импортируется в app.js.
- [ ] <!--0.71--> API размещено на отдельном поддомене, например api.movies-explorer.nomoreparties.co.
- [x] <!--0.71--> Для имени базы данных используется moviesdb.

## Количество баллов: 38

## Доп. Комментарии:
**1. В `package.json` не заполнено поле `description`.**
**2. Ошибки в консоли. После передачи ошибки в `next` необходимо прерывать работу кода. После отправки одного отвера в обработчике ошибок нужно также прерывать работу, чтобы не было попытки отправить еще один ответ.**
![2022-08-09_12-00-42](https://user-images.githubusercontent.com/86304001/183568104-e9cb4fc5-3f4f-41df-a10a-40e48eca6a1c.png)
**3. Использована стандартная ошибка вместо кастомной.**
![2022-08-09_12-09-11](https://user-images.githubusercontent.com/86304001/183569320-6b41d883-61b9-46d7-b8f2-cd087b0e58e5.png)
